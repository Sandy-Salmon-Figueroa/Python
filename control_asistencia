from datetime import datetime

class ControlAsistencia:
    def __init__(self):
        """Inicializa el sistema de asistencia"""
        self.asistentes = set()  # Para evitar duplicados
        self.registro_horas = {}  # Para guardar hora de ingreso
    
    def registrar_asistencia(self, nombre):
        """
        Registra la asistencia de una persona
        
        Args:
            nombre (str): Nombre de la persona
            
        Returns:
            bool: True si se registrÃ³ exitosamente, False si ya estaba registrada
        """
        nombre = nombre.strip().title()
        
        if nombre in self.asistentes:
            print(f"âŒ {nombre} ya estÃ¡ registrado en el sistema")
            return False
        
        # Registrar asistencia
        hora_actual = datetime.now().strftime("%H:%M:%S")
        self.asistentes.add(nombre)
        self.registro_horas[nombre] = hora_actual
        
        print(f"âœ… {nombre} registrado exitosamente a las {hora_actual}")
        return True
    
    def verificar_asistencia(self, nombre):
        """
        Verifica si una persona ya asistiÃ³
        
        Args:
            nombre (str): Nombre de la persona
            
        Returns:
            bool: True si ya asistiÃ³, False si no
        """
        nombre = nombre.strip().title()
        
        if nombre in self.asistentes:
            hora_registro = self.registro_horas[nombre]
            print(f"âœ… {nombre} SÃ asistiÃ³ (registrado a las {hora_registro})")
            return True
        else:
            print(f"âŒ {nombre} NO ha asistido")
            return False
    
    def mostrar_total_asistentes(self):
        """Muestra el nÃºmero total de asistentes Ãºnicos"""
        total = len(self.asistentes)
        print(f"\nğŸ‘¥ TOTAL DE ASISTENTES ÃšNICOS: {total}")
        return total
    
    def mostrar_lista_completa(self):
        """Muestra la lista completa de asistentes con sus horas de registro"""
        if not self.asistentes:
            print("ğŸ“‹ No hay asistentes registrados")
            return
        
        print("\n" + "="*60)
        print("ğŸ“‹ LISTA COMPLETA DE ASISTENTES")
        print("="*60)
        
        # Ordenar por hora de registro
        asistentes_ordenados = sorted(
            self.registro_horas.items(), 
            key=lambda x: x[1]  # Ordenar por hora
        )
        
        for i, (nombre, hora) in enumerate(asistentes_ordenados, 1):
            print(f"{i:2d}. {nombre:<20} - Hora de registro: {hora}")
    
    def obtener_estadisticas(self):
        """Muestra estadÃ­sticas del evento"""
        total = len(self.asistentes)
        
        if total == 0:
            print("ğŸ“Š No hay estadÃ­sticas disponibles (sin asistentes)")
            return
        
        # Encontrar primero y Ãºltimo en registrarse
        horas_items = list(self.registro_horas.items())
        primero = min(horas_items, key=lambda x: x[1])
        ultimo = max(horas_items, key=lambda x: x[1])
        
        print("\n" + "="*50)
        print("ğŸ“Š ESTADÃSTICAS DEL EVENTO")
        print("="*50)
        print(f"Total de asistentes Ãºnicos: {total}")
        print(f"Primer asistente: {primero[0]} a las {primero[1]}")
        print(f"Ãšltimo asistente: {ultimo[0]} a las {ultimo[1]}")
        
        # Calcular distribuciÃ³n por hora (simplificado)
        horas = [hora.split(':')[0] for hora in self.registro_horas.values()]
        hora_mas_concurrida = max(set(horas), key=horas.count)
        print(f"Hora de mayor concurrencia: {hora_mas_concurrida}:00")
    
    def exportar_lista(self):
        """Exporta la lista de asistentes a un formato legible"""
        if not self.asistentes:
            print("No hay datos para exportar")
            return
        
        lista_export = []
        lista_export.append("="*50)
        lista_export.append("LISTA DE ASISTENTES AL SEMINARIO")
        lista_export.append("="*50)
        
        asistentes_ordenados = sorted(
            self.registro_horas.items(), 
            key=lambda x: x[1]
        )
        
        for nombre, hora in asistentes_ordenados:
            lista_export.append(f"- {nombre} (registrado a las {hora})")
        
        lista_export.append(f"\nTotal: {len(self.asistentes)} asistentes")
        lista_export.append(f"Generado: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        
        return "\n".join(lista_export)

# Sistema interactivo
def sistema_interactivo():
    """Sistema interactivo de control de asistencia"""
    control = ControlAsistencia()
    
    while True:
        print("\n" + "="*50)
        print("ğŸ“ SISTEMA DE CONTROL DE ASISTENCIA")
        print("="*50)
        print("1. Registrar asistencia")
        print("2. Verificar asistencia")
        print("3. Mostrar total de asistentes")
        print("4. Mostrar lista completa")
        print("5. Ver estadÃ­sticas")
        print("6. Exportar lista")
        print("7. Salir")
        
        opcion = input("\nSeleccione una opciÃ³n (1-7): ").strip()
        
        if opcion == "1":
            print("\n--- Registrar asistencia ---")
            nombre = input("Nombre del asistente: ").strip()
            if nombre:
                control.registrar_asistencia(nombre)
            else:
                print("âŒ El nombre no puede estar vacÃ­o")
        
        elif opcion == "2":
            print("\n--- Verificar asistencia ---")
            nombre = input("Nombre a verificar: ").strip()
            if nombre:
                control.verificar_asistencia(nombre)
            else:
                print("âŒ El nombre no puede estar vacÃ­o")
        
        elif opcion == "3":
            print("\n--- Total de asistentes ---")
            control.mostrar_total_asistentes()
        
        elif opcion == "4":
            print("\n--- Lista completa de asistentes ---")
            control.mostrar_lista_completa()
        
        elif opcion == "5":
            print("\n--- EstadÃ­sticas del evento ---")
            control.obtener_estadisticas()
        
        elif opcion == "6":
            print("\n--- Exportar lista ---")
            lista = control.exportar_lista()
            print(lista)
            
            # OpciÃ³n para guardar en archivo
            guardar = input("\nÂ¿Desea guardar en archivo? (s/n): ").strip().lower()
            if guardar == 's':
                with open('lista_asistentes.txt', 'w', encoding='utf-8') as f:
                    f.write(lista)
                print("âœ… Lista guardada en 'lista_asistentes.txt'")
        
        elif opcion == "7":
            print("ğŸ‘‹ Â¡Hasta pronto!")
            break
        
        else:
            print("âŒ OpciÃ³n no vÃ¡lida. Por favor, seleccione 1-7")

# Ejemplo rÃ¡pido de uso
def ejemplo_rapido():
    """Ejemplo rÃ¡pido del sistema en funcionamiento"""
    print("ğŸ”¬ EJEMPLO RÃPIDO DEL SISTEMA")
    print("="*40)
    
    control = ControlAsistencia()
    
    # Registrar algunas asistencias
    control.registrar_asistencia("Ana GarcÃ­a")
    control.registrar_asistencia("Carlos LÃ³pez")
    control.registrar_asistencia("MarÃ­a RodrÃ­guez")
    
    # Intentar duplicado
    control.registrar_asistencia("Ana GarcÃ­a")
    
    # Verificar asistencias
    control.verificar_asistencia("Carlos LÃ³pez")
    control.verificar_asistencia("Pedro SÃ¡nchez")
    
    # Mostrar resultados
    control.mostrar_lista_completa()
    control.mostrar_total_asistentes()
    
    print("\n" + "="*40)
    print("ğŸ“Š ESTADÃSTICAS:")
    control.obtener_estadisticas()

if __name__ == "__main__":
    # Ejecutar ejemplo rÃ¡pido
    ejemplo_rapido()
    
    # Ejecutar sistema interactivo
    print("\n\nğŸ® SISTEMA INTERACTIVO")
    sistema_interactivo()
